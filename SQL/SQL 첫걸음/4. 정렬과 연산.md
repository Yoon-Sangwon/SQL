# 3장. 정렬과 연산



## 9강 정렬 - ORDER BY

> SELECT 명령의 ORDER BY 구를 사용하여 검색결과의 행 순서를 바꿀 수 있습니다. 이제 정렬(sort) 방법을 배워보겠습니다.
>
> SELECT 명령에 ORDER BY 구를 지정하면 검색 결과이 행 순서를 바꿀 수 있습니다. ORDER BY 구를 지정하지 않을 경우에는 DB 내부에 저장된 순서로 반환됩니다. 언제나 정해진 순서로 결과값을 얻기 위해서는 ORDER BY 구를 지정해야 합니다.



### 9.1 ORDER BY로 검색 결과 정렬하기

> SELECT 명령의 ORDER BY 구로 정렬하고 싶은 열을 지정합니다. 지정된 열의 값에 따라 행 순서가 변경됩니다. 이때 **ORDER BY 구는 WHERE 구 뒤에 지정**합니다. 검색 조건이 필요없는 경우에는 WHERE 구를 생략하는데 이때 ORDER BY 구는 FROM 구의 뒤에 지정합니다.

```mysql
SELECT * FROM sample31;
```

---

결과

| name | age  | address           |
| ---- | ---- | ----------------- |
| A씨  | 36   | 대구광역시 중구   |
| B씨  | 18   | 부산광역시 연제구 |
| C씨  | 25   | 서울특별시 중구   |

---

```mysql
SELECT * FROM sample31 ORDER BY age;
```

---

결과

| name | age  | address           |
| ---- | ---- | ----------------- |
| B씨  | 18   | 부산광역시 연제구 |
| C씨  | 25   | 서울특별시 중구   |
| A씨  | 36   | 대구광역시 중구   |

---



### 9.2 ORDER BY DESC로 내림차순으로 정렬하기

> ORDER BY 구에 지정한 열의 값에 따라 행의 순서가 바뀐다는 것을 알았습니다. 앞선 예제에서는 오름차순으로 정렬하였습니다. 이제 반대로 내림차순으로 정렬해보겠습니다. 내림차순은 열명 뒤에 DESC를 붙여 지정합니다.
>
> - 내림차순
>
> ```mysql
> SELECT 열명 FROM 테이블명 ORDER BY 열명 DESC
> ```
>
> - 오름차순
>
> ```mysql
> SELECT 열명 FROM 테이블명 ORDER BY 열명 (ASC)
> ```
>
> - 즉 오름차순은 내림차순과 달리 생략이 가능합니다.



### 9.3 대소관계

> ORDER BY로 정렬할 때는 값으 대소관계가 중요합니다. 수치형 데이터라면 대소관계 판별이 쉽습니다.
>
> 마찬가지로 **날짜시간형 데이터도 수치형 데이터처럼 숫자 크기로 판별**합니다.
>
> 그렇다면 문자열형 데이터는 어떻게 판별할까요? 우선 알파벳과 한글은 알파벳 → 한글 순이며, 한글은 자음 → 모음 순입니다.  즉, **문자열형 데이터의 대소관계는 이처럼 '사전식 순서' 에 의해 결정**됩니다.

##### 사전식 순서에서 주의할 점

- **수치형과 문자열형은 대소관계 계산 방법이 서로 다릅니다.** 수치형은 수치의 대소관계로, 문자열형은 사전식 순서로 비교합니다.
- 즉, 문자열형 숫자는 사전식 순서로 비교하기 때문에 1, 10, 2 순서로 대소관계가 구분됩니다.



### 9.4 ORDER BY는 테이블에 영향을 주지 않는다.

> ORDER BY를 이용해 행 순서를 바꿀 수 있습니다. 하지만 이는 어디까지나 서버에서 클라이언트로 행 순서를 바꾸어 결과를 반환하는 것 뿐, 저장장치에 저장된 데이터의 행 순서를 변경하는 것은 아닙니다.
>
> SELECT 명령은 데이터를 검색하는 명령입니다. 이는 테이블의 데이터를 참조만 할 뿐이며 변경은 하지 않습니다.



## 10강 복수의 열을 지정해 정렬하기

> ORDER BY 구로 간단히 행을 정렬할 수 있다는 것을 알았습니다. 이제는 복수 열을 지정해 정렬하는 방법에 대해 알아봅시다.
>
> 데이터 양이 많을 경우 하나의 열만으로는 행을 특정짓기 어려운 때가 많습니다. 예를들어 명세서는 '상품코드'와 '해당 상품의 하위번호'까지 함께 고려했을 때 비로소 하나의 행을 특정지을 수 있습니다. 이런 경우 복수의 열을 지정해 정렬하면 편리합니다.
>
> 단, **정렬 시에는 NULL 값에 주의해야 합니다.** 10강의 마지막에는 NULL 값의 정렬 순서에 관해 다루겠습니다.



### 10.1 복수 열로 정렬 지정

> ORDER BY로 행을 정렬하는 경우 같은 값을 가진 행의 순서는 어떻게 정해지는 걸까요? 또 ORDER BY 구는 생략할 수 있는데 이때 순서는 어떻게 정해질까요?
>
> 정답은 '**순서는 일정하지 않다**' 입니다. 데이터베이스 서버의 당시 상황에 따라 어떤 순서로 행을 반환할지 결정됩니다. 따라서 언제나 같은 순서로 결과를 얻고 싶다면 반드시 ORDER BY 구로 순서를 지정해야 합니다. 일반적으로 ORDER BY 구를 지정하지 않는 경향이 있지만 사실 중요한 부분입니다.
>
> ORDER BY 구를 지정해도 1개의 열만으로는 정확히 순서를 결정할 수 없는 경우도 많습니다.
>
> ```mysql
> SELECT * FROM sample32;
> ```
>
> ---
>
> 결과
>
> | a    | b    |
> | ---- | ---- |
> | 1    | 1    |
> | 2    | 1    |
> | 2    | 2    |
> | 1    | 3    |
> | 1    | 2    |
>
> ---
>
> a 열, b 열 모두 INTEGER 형입니다. 열에는 1이나 2와 같은 값이 들어가 있습니다. b 열은 a 열의 하위 번호입니다. 이를 '1-1', '1-2', '1-3', '2-1' 와 같이 열의 상관관계에 맞춰 정렬하려 합니다.
>
> ORDER BY를 이용해 a 열을 정렬해보겠습니다.
>
> ```MYSQL
> SELECT * FROM sample32 ORDER BY a;
> ```
>
> ---
>
> 결과
>
> | a    | b    |
> | ---- | ---- |
> | 1    | 1    |
> | 1    | 3    |
> | 1    | 2    |
> | 2    | 1    |
> | 2    | 2    |
>
> ---
>
> 그 결과 a는 순서대로 정렬 되었지만 b열의 정렬 순서가 일정하지 않습니다. a 열의 값이 1인 행이 총 3개가 있는데 서로 값이 똑같아 순서를 결정할 수 없기 때문입니다.

##### ORDER BY로 복수 열 지정하기

- ORDER BY 구에는 복수로 열을 지정할 수 있습니다. **SELECT 구에서 열을 지정한 것처럼 콤마(,)로 열명을 구분해 지정**하면 됩니다.

- 복수 열을 지정하면 정렬 결과가 바뀝니다. 정렬 순서는 지정한 열명의 순서를 따릅니다. 이때 값이 같아 순서를 결정할 수 없는 경우에는 다음으로 지정한 열명을 기준으로 정렬하는 식으로 처리됩니다.

- sample32를 다시 해보겠습니다. ORDER BY a, b로 지정해 먼저 a열로 정렬하고, 값이 같은 부분은 b열로 정렬합니다.

  ```MYSQL
  SELECT * FROM sample32 ORDER BY a, b;
  ```

  ---

  결과

  | a    | b    |
  | ---- | ---- |
  | 1    | 1    |
  | 1    | 2    |
  | 1    | 3    |
  | 2    | 1    |
  | 2    | 2    |

  ---



### 10.2 정렬방법 지정하기

> 복수 열을 지정한 경우에도 각 열에 대해 개별적으로 정렬방법을 지정할 수 있습니다. 이때는 각 열 뒤에 ASC나 DESC를 붙여줍니다.
>
> ```MYSQL
> SELECT * FROM 테이블명 ORDER BY 열명1 [ASC|DESC], 열명2 [ASC|DESC], ...;
> ```
>
> 구문 중에 [] 부분은 생략 가능하며 |는 둘중 하나라는 뜻입니다. 또한 ...은 동일한 형태로 연속해서 지정할 수 있다는 의미입니다.
>
> - sample32를 사용해 열1은 ASC로 정렬, 열2는 DESC로 정렬하면 다음과 같습니다.
>
>   ```MYSQL
>   SELECT * FROM sample32 ORDER BY a ASC, b DESC;
>   ```
>
>   ---
>
>   결과
>
>   | a    | b    |
>   | ---- | ---- |
>   | 1    | 3    |
>   | 1D   |      |
>   |      | 1    |
>   | 2    | 2    |
>   | 2    | 1    |
>
>   ---
>
> 복수 열을 지정하는 경우에도 정렬방법을 생략하면 기본값은 ASC이지만, DB 제품에 따라 기본값을 변경할 수 있으니 주의해야합니다. 그러니 문장의 가독성을 높이기 위해서라도 가능한 정렬방법을 생략하지 말고 지정하도록 합시다.



### 10.3 NULL 값의 정렬순서

>ORDER BY로 정렬하는 방법에 관해 알아보았습니다. 지금부터는 NULL 값이 저장된 열의 정렬방법을 살펴보겠습니다.
>
>NULL 값은 그 특성상 대소비교를 할 수 없어 정렬시에는 별도의 방법으로 취급합니다. 이때 '특정 값보다 큰 값', '특정 값보다 작은 값' 의 두 가지로 나뉘며 이 중 하나의 방법으로 대소를 비교합니다.
>
>간단히 말하면 **ORDER BY로 지정한 열에서 NULL 값이 가지는 행은 가장 먼저 표시되거나 가장 나중에 표시**됩니다. NULL 값에 대한 대소비교 방법은 표준 SQL에도 규정되어 있지 않아 DB 제품에 따라 다릅니다. MySQL의 경우 NULL 값을 가장 작은 값으로 취급합니다.



## 11강 결과 행 제한하기 - LIMIT

> SELECT 명령에는 결과값으로 반환되는 행을 제한할 수 있습니다. 이제 LIMIT 구로 결과 행을 제한하는 방법에 대해 설명하겠습니다.



### 11.1 행수 제한

> LIMIT 구는 표준 SQL은 아닙니다. **MySQL과 PostgreSQL 에서만 사용할 수 있는 문법**입니다. LIMIT 구는 SELECT 명령의 마지막에 지정하는 것으로 WHERE나 ORDER BY 구의 뒤에 지정합니다.
>
> LIMIT 다음에는 최대 행수를 수치로 지정합니다. 만약 LIMIT 10으로 지정하면 최대 10개의 행이 클라이언트로 반환됩니다. 그럼 sample33 테이블을 이용해 확인해보겠습니다.
>
> ```MYSQL
> SELECT * FROM sample33;
> ```
>
> ---
>
> 결과
>
> | no   |
> | ---- |
> | 1    |
> | 2    |
> | 3    |
> | 4    |
> | 5    |
> | 6    |
> | 7    |
>
> ---
>
> ```MYSQL
> SELECT * FROM sample33 LIMIT 3;
> ```
>
> ---
>
> 결과
>
> | no   |
> | ---- |
> | 1    |
> | 2    |
> | 3    |
>
> ---
>
> LIMIT으로 지정하는 것은 최대 행 수 입니다. 만약 sampe33의 행이 1개였다면, LIMIT을 3으로 했어도 1개가 출력되었을 것입니다.



- LIMIT 구로 반환될 행 수를 제한할 수 있다

  - LIMIT 3을 한 것과 동일한 결과를 얻기 위해 WHERE구에서 조건을 지정할 수도 있습니다. 예를 들어, 'WHERE no <= 3' 조건을 주었다면 동일한 결과를 얻을 수 있습니다.
  - 그러나 LIMIT과 WHERE은 기능과 내부처리 순서가 전혀 다릅니다. LIMIT은 반환할 행 수를 제한하는 기능으로, WHERE 구로 검색 후, ORDER BY로 정렬된 뒤에 최정족으로 처리됩니다.

  ```MYSQL
  SELECT * FROM sample33 ORDER BY no DESC LIMIT 3;
  ```

  ---

  결과

  | no   |
  | ---- |
  | 7    |
  | 6    |
  | 5    |

  ---

- LIMIT을 사용할 수 없는 DB에서의 행 제한

  - LIMIT은 표준 SQL이 아니기 때문에 MySQL과 PostgreSQL 이외의 DB에서는 사용할 수 없습니다. SQL Server에서는 LIMIT과 비슷한 기능을 하는 TOP을 사용할 수 있습니다.

    ```MYSQL
    SELECT TOP3 * FROM sample33;
    ```

  - Oracle에는 LIMIT도 TOP도 없습니다. 대신 ROWNUM이라는 열을 사용해 WHERE 구로 조건을 지정해야 행을 제한 할 수 있습니다.

    ```MYSQL
    SELECT * FROM sample33 WHERE ROWNUM <= 3;
    ```

  - 단 ROWNUM으로 행을 제한할 때는 WHERE 구로 지정하므로 정렬하기 전에 처리되어 LIMIT과 결과값이 다릅니다. 이 문제는 5장의 'FROM 구에서 서브쿼리 사용하기' 에서 설명하겠습니다.

### 11.2 오프셋 지정

