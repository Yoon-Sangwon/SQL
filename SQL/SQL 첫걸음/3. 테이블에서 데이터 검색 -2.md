# 2장 테이블에서 데이터 검색



## 7강 조건 조합하기

> 조건을 조합하여 더 세밀하게 검색할 수 있도록 3개의 논리 연산자 AND, OR, NOT에 관해 설명하겠습니다. 실제로 SELECT 명령을 사용해서 DB에서 데이터를 검색할 때 단순한 조건식을 넣으면 많은 결과값이 반환되어 한눈에 알아보기 힘듭니다. 따라서 **통상적으로 2개 이상의 조건식을 조합해 검색**하는 경우가 많습니다. 조건식을 조합해 사용할 경우 복수의 조건을 WHERE 구로 지정합니다. **조합할 때는 AND, OR, NOT의 3가지 방법을 사용할 수 있습니다.**



### 7.1 AND로 조합하기

> 복수의 조건으로 조합할 경우 AND를 가장 많이 사용합니다. AND는 논리 연산자의 하나로 좌우에 항목이 필요한 이항 연산자가 됩니다. 좌우의 식 모두 참일 경우 AND 연산자는 참을 반환합니다. **'모든 조건을 만족하는 경우 조건식이 참이 된다'** 고 할때 AND 연산자로 조건식을 조합합니다.

```mysql
SELECT * FROM sample24;
```

---

결과

| no   | a    | b    | c    |
| ---- | ---- | ---- | ---- |
| 1    | 1    | 0    | 0    |
| 2    | 0    | 1    | 0    |
| 3    | 0    | 0    | 1    |
| 4    | 2    | 2    | 0    |
| 5    | 0    | 2    | 2    |

---

- 여기서 a와 b가 0이 아닌 행을 검색하고 싶은 경우 다음과 같이 AND로 작성해줍니다.

- ```mysql
  SELECT * FROM sample24 WHERE a<>0 AND b<>0;
  ```

  ---

- 결과

- | no   | a    | b    | c    |
  | ---- | ---- | ---- | ---- |
  | 4    | 2    | 2    | 0    |

  ---

- a가 0이 아닌 행은 no가 1이고 4인 행이고, b가 0이 아닌 행은 no가 2, 4, 5인 행입니다. AND는 두 조건식 모두가 만족해야 하기 때문에 no가 4인 행만이 출력됩니다.

- 즉 AND 연산자는 벤 다이어 그램에서 교집합을 의미합니다.



### 7.2 OR로 조합하기

> **'어느 쪽이든 하나만 참이 되면 조건식은 참이 된다.'** 라고 할 경우에는 OR로 조건식을 연결합시다. OR 또한 논리 연산자의 하나로 좌우 항목이 모두 필요한 이항 연산자입니다. AND와 달리 어느 쪽이든 조건을 만족하면 결과는 참이 됩니다. 모든 조건이 거짓인 경우 결과는 거짓이 됩니다.

```mysql
SELECT * FROM sample24 WHERE a<>0 OR b<>0;
```

---

결과

| no   | a    | b    | c    |
| ---- | ---- | ---- | ---- |
| 1    | 1    | 0    | 0    |
| 2    | 0    | 1    | 0    |
| 4    | 2    | 2    | 0    |
| 5    | 0    | 2    | 2    |

---



### 7.3 AND와 OR를 사용할 경우 주의할 점

> AND 연산자나 OR 연산자의 좌우로 참과 거짓을 반환하는 조건식을 지정하는 경우가 많습니다. **열이나 상수만을 지정해도 에러가 발생하지는 않지만 기대한 결과값을 얻을 수 없습니다.**
>
> - 원하는 결과값 얻지 못함
>
>   ```mysql
>   SELECT * FROM sample24 WHERE no = 1 OR 2;
>   ```
>
> - 원하는 결과값 얻음
>
>   ```mysql
>   SELECT * FROM sample24 WHERE no = 1 OR no = 2;
>   ```

- AND와 OR을 조합해 사용하기
  
  - AND와 OR을 사용한 조건식으로 'a열은 0이 아니다' 라는 것을 던졌습니다. 0, 1, 2라는 3개의 값이 있다면 a <> 0은 1이나 2의 경우 참이됩니다. '~이 아닌' 이라는 조건보다 '~인' 이라는 조건이 더 이해하기 쉬울 것입니다. **7.2의 'a<>0'을 'a = 1 OR a = 2'** 라는 조건으로 바꾸어 보겠습니다.
  
  - ```mysql
    SELECT * FROM sample24 WHERE a = 1 OR a = 2 AND b = 1 OR b = 2;
    ```
  
    ---
  
    결과
  
    | no   | a    | b    | c    |
    | ---- | ---- | ---- | ---- |
    | 1    | 1    | 0    | 0    |
    | 4    | 2    | 2    | 0    |
    | 5    | 0    | 2    | 2    |
  
    ---
  
  - 이는 7.2 의 결과와 다릅니다.



- 연산자의 우선순위

  - 위와 같이 두 결과가 다른 이유는 AND와 OR의 계산 우선순위가 다르기 때문입니다. OR보다 AND가 우선수위가 높기 때문에 **'a = 2 AND b = 1'이 먼저 계산**됩니다.

  - ```mysql
    SELECT * FROM sample24 WHERE a = 1 OR (a = 2 AND b = 1) OR b = 2;
    ```

  - 만약 7.2와 같은 조건으로 지정하기 위해서는 괄호로 우선순위를 변경하면 됩니다.

  - ```mysql
    SELECT * FROM sample24 WHERE (a = 1 OR a = 2) AND (b = 1 OR b = 2);
    ```

  - 일반적으로 OR 조건식은 괄호로 묶어 지정하는 경우가 많습니다. **조건이 잘못 지정되는 것을 막기 위해 괄호로 묶어두는 습관을 붙이는 것이 좋습니다.**



### 7.4 NOT으로 조합

> 지금까지 논리 연산자 AND와 OR에 대해 알아보았습니다. 이제 또 다른 논리 연산자인 NOT에 대해 알아봅시다.
>
> **NOT 연산자는 오른쪽에만 항목을 지정하는 '단항 연산자'**입니다. 오른쪽에 지정한 조건식의 반대 값을 반환합니다. 만약 조건식이 참을 반환하면 NOT은 이에 반하는 거짓을 반환합니다. **주로 복수의 조건식에 대해 '~ 아닌', '~ 외에', '~ 를 제외한 나머지' 등의 조건을 지정할 경우 사용**합니다.

```mysql
SELECT * FROM sample24 WHERE NOT (a <> 0 OR b <> 0);
```

---

결과

| no   | a    | b    | c    |
| ---- | ---- | ---- | ---- |
| 3    | 0    | 0    | 1    |

---

- 이를 집합으로 표시하면 (A∪B) ͨ  입니다.



## 8강 패턴 매칭에 의한 검색

> 이제 패턴 매칭으로 검색하는 방법에 대해 알아봅시다. **'LIKE' 술어를 사용하면 문자열의 일부분을 비교하는 '부분 검색' 을 할 수 있습니다.** = 연산자로 검색하는 경우는 셀의 데이터 값이 완전히 동일한지를 비교합니다. 하지만 '특정 문자나 문자열이 포함되어 있는지를 검색하고 싶은' 경우도 많습니다. 이런 경우 **'패턴 매칭' 또는 '부분 검색'**이라고도 합니다.
>
> **LIKE 에 의한 패턴 매칭은 간단한 경우에는 충분하지만 더 복잡한 패턴을 매칭하는 경우는 정규 표현식을 사용하는 편이 낫습니다.** 최근에는 대부분의 DB가 정규 표현식을 지원합니다. 정규 표현식에는 더 많은 메타문자를 사용해서 폭넓게 패턴을 지정할 수 있습니다.



### 1. LIKE로 패턴 매칭하기

> LIKE 술어를 사용하면 열 값이 부분적으로 일치하는 경우에도 참이 됩니다. LIKE 술어는 이항 연산자 처럼 항목을 지정합니다. **왼쪽에는 매칭 대상을 지정하고 오른쪽에는 패턴 문자열로 지정**합니다. 단, **수치형 상수는 지정할 수 없습니다**. 패턴을 정의할 때는 **'%'** 같은 ***메타문자*** 를 사용할 수 있습니다. *'와일드 카드' 라고도 불리는 메타문자는 패턴 매칭 시 '임의의 문자 또는 문자열'에 매치하는 부분을 지정하기 위해 쓰이는 특수 문자* 입니다. **퍼센트(%)는 임의의 문자열을 의미**하며, **언더스코어(_)는 임의의 문자 하나를 의미**합니다. 패턴을 정의할 때는 메타문자를 여러 개 사용할 수 있습니다. 물론 메타문자를 전혀 정의하지 않아도 문제는 없지만 완전 일치로 검색되므로 정의하는 의미가 없습니다. 와일드 카드로 자주 쓰이는 *은 LIKE에서는 사용할 수 없습니다.

```MYSQL
SELECT * FROM sample25;
```

---

결과

| no   | text                                                |
| ---- | --------------------------------------------------- |
| 1    | **SQL**은 RDBMS를 조작하는 언어이다.                |
| 2    | LIKE에서는 메타문자 %와 _를 사용할 수 있다.         |
| 3    | LIKE는 **SQL**에서 사용할 수 있는 술어 중 하나이다. |

---

> sample25 테이블의 text 열에는 문자열이 저장되어 있습니다. 전부 3개의 행이 존재합니다. 여기에서 문자열 SQL을 포함하는 행을 패턴 매칭으로 검색해보겠습니다. 

```mysql
SELECT * FROM sample25 WHERE text LIKE 'SQL%';
```

---

결과

| no   | text                                 |
| ---- | ------------------------------------ |
| 1    | **SQL**은 RDBMS를 조작하는 언어이다. |

---

> 'SQL'을 포함하는 행이 문제없이 검색되었지만, sample25를 보면 no가 3인 행에도 'SQL'이 포함되어 있습니다. 이 행이 검색되지 않은 이유는 SQL로 시작되지 않기 때문입니다. **결론적으로 'SQL%'는 SQL이라는 문자로 시작하는 행만 검색된 것입니다.**

```mysql
SELECT * FROM sample25 WHERE text LIKE '%SQL%';
```

---

결과

| no   | text                                                |
| ---- | --------------------------------------------------- |
| 1    | **SQL**은 RDBMS를 조작하는 언어이다.                |
| 3    | LIKE는 **SQL**에서 사용할 수 있는 술어 중 하나이다. |

---

> 핵심은 **앞에 '%'와 매칭되는 아무 단어가 없는 경우에도 검색 되었다는 것**입니다. no가 1인 행은 SQL 앞에 아무 단어도 없지만 검색된 것을 알 수 있습니다.
>
> 'SQL %' 를 이용한 검색은 **'전방 일치'** 라고 부르며 '% SQL %'로 검색한 것은 **'중간 일치'**, '% SQL'로 검색하면 **'후방 일치'** 라고 부릅니다. 



### 2. LIKE로 %를 검색하기

> sample25의 두 번째 행은 데이터 안에 %와 _를 포함합니다. 이는 메타 문자와 동일한 문자로 이를 LIKE로 검색할 경우 어떻게 정의하는지 알아보도록 하겠습니다.
>
> LIKE에서 메타문자 부분이 임의의 문자열을 의미하므로, **% 를 '%%%' 식으로 %로 감싸도 매치가 되지않습니다**. 프로그래밍 세계에서는 이러한 문제를 '이스케이프' 라는 방법으로 처리할 수 있습니다. LIKE로 %를 검색하는 경우에는 ' \\% ' 와 같이 \\를 앞에 붙입니다. 결론적으로 %를 포함하는 데이터를 검색하고 싶을 경우 조건식은 다음과 같습니다.
>
> ```mysql
> SELECT * FROM sample25 WHERE text LIKE '% \% %'
> ```



### 3. 문자열 상수 '의 이스케이프

> 메타 문자를 검색할 때처럼 문자열 상수를 검색할 때도 같은 문제가 발생합니다. 문자열 상수는 '문자열' 과 같이 '로 둘러싸 표기합니다. 그렇다면 문자열 안에 '를 포함하고 싶다면 어떻게 해야할까요?
>
> 예를들어 It's 를 표기하고 싶다면 'It''s' 라고 표기합니다. **' 하나의 문자열 데이터를 사용할 경우 ''''으로 쓰면 됩니다.**

