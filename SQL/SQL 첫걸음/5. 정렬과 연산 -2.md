# 4장. 정렬과 연산



## 12강 수치 연산

> SQL은 DB를 조작하는 언어이지만 컴퓨터를 조작하는 언어이기도 한만큼 기본적으로 계산기능을 포함합니다. 이제 계산하는 방법, 특히 수치의 연산 방법을 알아봅시다.
>
> 어떤 계산을 할 지는 연산자를 이용해 지정합니다. WHERE 구에서 조건을 지정할 때 사용했던 '=' 역시 연산자의 하나입니다. 여기에서는 수치를 연산하는 산술 연산에 관해 설명하겠습니다. 산술연산은 다른 프로그래밍 언어에서도 사용하는 기본 개념이므로 중요합니다.



### 12.1 사칙연산

> 산술 연산이라고해도 그리 어렵지 않습니다. 덧셈, 뺄셈, 곱셈, 나눗셈의 사칙 연산과 나눗셈의 나머지, 크게 이 두 가지를 기본적으로 익혀두면 됩니다.
>
> 연산자는 기호로 표현합니다. 각 연산자는 다음과 같습니다.
>
> | 연산자 | 연산         | 예           |
> | ------ | ------------ | ------------ |
> | +      | 덧셈(가산)   | 1 + 2 -> 3   |
> | -      | 뺄셈(감산)   | 3 - 1 -> 2   |
> | *      | 곱셈(승산)   | 2 * 5 -> 10  |
> | /      | 나눗셈(제산) | 1 / 2 -> 0.5 |
> | %      | 나머지       | 3 % 2 -> 1   |
>
> 사칙연산을 컴퓨터 언어로는 어떻게 표현하는지 조금 설명하겠습니다.
>
> 곱셈은 X 기호를 사용하지만 컴퓨터 언어에서는 x 기호가 존재하지 않아 대신 애스터리스크( * )를 사용합니다. *는 모든 열을 의미하는 메타문자이면서 동시에 연산자로도 사용할 수 있습니다. 나눗셈 기호는 ÷이지만 슬래시( / )를 사용합니다. 나머지는 %를 사용하는데 DB에 따라 MOD 함수를 사용하는 경우도 있습니다.



### 12.2 SELECT 구로 연산하기

> 2장에서 SELECT 구에서는 열명을 지정한다고 배웠지만 이외에도 여러가지 식을 기술할 수 있습니다. 이 식은 열명, 연산자, 상수로 구성됩니다. 식을 기술할 수 있다는 것은 명령이 실행될 때 연산을 할 수 있다는 것을 의미합니다. sample34 테이블로 확인해봅시다.
>
> ```MYSQL
> SELECT * FROM sample34;
> ```
>
> ---
>
> 결과
>
> | no   | price | quantity |
> | ---- | ----- | -------- |
> | 1    | 100   | 10       |
> | 2    | 230   | 24       |
> | 3    | 1980  | 1        |
>
> ---
>
> 다음 데이터 테이블을 이용해 가격과 수량으로 금액을 계산하는 경우를 생각해 보겠습니다. 예를들어 가격이 100원인 상품을 10개 주문하면 주문 금액은 1,000원이 됩니다. 즉 '단가' * '개수' 라는 연산식으로 계산할 수 있습니다. SELECT 구에서 다음 식은 price * quantity로 계산 가능하고 * 앞뒤에 스페이스를 넣을 필요는 없습니다.
>
> ```MYSQL
> SELECT *, price * quantity FROM sample34;
> ```
>
> ---
>
> 결과
>
> | no   | price | quantity | price * quantity |
> | ---- | ----- | -------- | ---------------- |
> | 1    | 100   | 10       | 1000             |
> | 2    | 230   | 24       | 5520             |
> | 3    | 1980  | 1        | 1980             |



### 12.3 열의 별명

> SELECT 결과에서 price * quantity 라고 명명된 열이 금액을 계산한 부분입니다. 이때 price * quantity 와 같이 **열 이름이 길고 알아보기 어려운 경우에는 별명을 붙여 열명을 재지정**할 수 있습니다. 이제 price * quantity에 amount라는 별명을 붙여보겠습니다.
>
> ```MYSQL
> SELECT *, price * quantity AS amount FROM sample34;
> ```
>
> ---
>
> 결과
>
> | no   | price | quantity | amount |
> | ---- | ----- | -------- | ------ |
> | 1    | 100   | 10       | 1000   |
> | 2    | 230   | 24       | 5520   |
> | 3    | 1980  | 1        | 1980   |
>
> ---
>
> 별명은 예약어 AS를 사용해 지정합니다. SELECT 구에서는 콤마(,)로 구분해 복수의 식을 지정할 수 있으며 각각의 식에 별명을 붙일 수 있습니다. MySQL에서는 별명을 중복해서 지정해도 에러가 발생하지 않지만 프로그래밍 언어에서 결과값의 처리방식에 따라 문제가 발생할 수 있습니다. 따라서 기본적으로 중복되지 않도록 지정해야합니다.
>
> 키워드 AS는 생략할 수 있습니다. 'SELECT price * quantity amount' 라고 작성하여도 무방합니다. 에일리어스(alias) 라고 불리는 별명은 영어, 숫자, 한글 등으로 지정할 수 있습니다. 단, 별명을 한글로 지정하는 경우에는 여러가지 오작동하는 경우가 많으므로 더블쿼트(MySQL에서는 백쿼트)로 둘러싸서 지정합니다.
>
> ```MYSQL
> SELECT price * quantity "금액" FROM sample34;
> ```
>
> 더블 쿼트로 둘러싸면 명령 구문을 분석할 때 DB 객체의 이름이라고 간주합니다. 반면 싱글쿼트로 둘러싸는 것은 문자열 상수입니다.
>
> 앞서 2장에서 **예약어와 같은 이름은 지정할 수 없다고 설명했지만, 더블쿼트로 둘러싸서 지정하면 사용할 수 있습니다.** 예를들어 SELECT는 예약어지만 ""로 둘러싸면 문제없이 지정할 수 있습니다. 또한 별명을 붙일 때는 숫자로 시작할 수 없습니다. 수치형 상수를 명령 안에서 사용할 경우에는 쿼트로 묶지 않고 숫자만 입력합니다. 이때 이름이 숫자로 시작한다면 수치형 상수인지 객체명을 의미하는 것인지 구별할 수 없습니다. 따라서 **DB 객체명은 숫자로 시작하면 안됩니다.** 물론, 더블쿼트로 둘러싸면 지정할 있습니다.



### 12.4 WHERE 구에서 연산하기

> SELECT 구에 이어, 지금부터는 WHERE 구에서의 연산방법을 알아보겠습니다. 구체적으로, sample34 테이블에서 '가격 * 수량'의 금액이 2000운 이상에 해당하는 행을 검색하겠습니다.
>
> ```mysql
> SELECT *, price * quantity AS amount FROM sample34
> 	WHERE price * quantity >= 2000;
> ```
>
> ---
>
> 결과
>
> | no   | price | quantity | amount |
> | ---- | ----- | -------- | ------ |
> | 2    | 230   | 24       | 5520   |
>
> ---
>
> ​	WHERE 구의 조건식은 'price * quantity >= 2000' 입니다. 이는 price * quantity 가 2000 이상인 행을 검색하라는 뜻입니다. 그 결과 no가 2인 행 하나만 검색되었습니다.
>
> 이때 WHERE 구에서 price * quantity 를 amount로 작성하면 되지않을까라는 의문이 들 수 있습니다. 그러나 실제로 amount를 작성하면 amount라는 행이 존재하지 않는다는 에러가 나옵니다.

##### WHERE 구와 SELECT 구의 내부처리 순서

- WHERE 구에서의 행 선택, SELECT 구에서의 열 선택은 DB 서버내부에서 **WHERE구 다음으로 SELECT구 순서로 처리**됩니다.
- 표준 SQL에는 내부처리 순서가 따로 정해져 있지 않습니다. 하지만 WHERE구에서 SELECT구 순으로 내부 처리를 하는 DB가 많습니다.따라서 WHERE 구로 행이 조건에 일치하는지를 먼저 조사한 후에 SELECT구에서 지정된 열을 선택해 결과에 반영합니다.
- 따라서 WHERE이 먼저 실행되기 때문에 SELECT구에서의 별칭이 반영되지 않는 것입니다.



### 12.5 NULL 값의 연산

> NULL 값을 이용해 'NULL + 1' 과 같은 연산을 하면 결과가 어떻게 나올까요? C나 PHP 언어로 프로그래밍한 경험이 있다면 1이라고 대답할 수도 있겠습니다. 그러나 SQL에서는 NULL 값이 0으로 처리되지 않습니다. 따라서 NULL + 1의 결과는 NULL 입니다. 특히 나눗셈에서 1 / NULL을 하여도 결과는 Division by zero가 아닌 NULL로 반환됩니다.



### 12.6 ORDER BY 구에서 연산하기

> ORDER BY 구에서도 연산할 수 있고, 그 결과값들을 정렬할 수 있습니다. 마찬가지로 sample34 테이블을 사용해 '가격 * 수량' 이 큰 순서대로 정렬해보겠습니다.
>
> ```MYSQL
> SELECT *, price * quantity AS amount FROM sample34
> 	ORDER BY price * quantity DESC;
> ```
>
> ---
>
> 결과
>
> | no   | price | quantity | amount |
> | ---- | ----- | -------- | ------ |
> | 2    | 230   | 24       | 5520   |
> | 3    | 1980  | 1        | 1980   |
> | 1    | 100   | 10       | 1000   |
>
> ---
>
> ORDER BY는 서버에서 내부적으로 가장 나중에 처리됩니다. 즉, SELECT 구보다 나중에 처리되기 때문에 amount라는 별명을 사용해도 무관합니다.



### 12.7 함수

> 연산자 외에 함수를 사용해 연산할 수도 있습니다. 함수는 다음과 같은 문법으로 표기합니다. 연산자는 기호에 따라 연산 방법이 결정됩니다. 즉, +기호는 덧셈에 사용되는 식입니다. 한편 **함수는 함수명에 따라 연산 방법이 결정**됩니다. 연산자는 좌우 항목이 연산 대상이 되지만, 함수는 계산 대상을 인수로 지정합니다. 이때 인수는 함수명 뒤에 괄호로 묶어 표기합니다. 인수의 수나 구분 방법은 함수에 따라 다르지만, 대부분의 함수는 1개 이상의 인수를 가집니다. 인수는 파라미터 라고도 부릅니다. 또한 연산자가 그러하듯 함수 역시 결과값을 반환합니다. 이를 함수의 반환값 이라고 부릅니다.
>
> 사실 연산자도 함수도 같은 것이라고 할 수 있습니다. 다만 표기 방법이 다를 뿐입니다. 여기서는 간단하게 나머지를 계산하는 %와 MOD 함수를 서로 비교해보겠습니다. % 연산자는 MySQL 등 에서 사용할 수 있는 연산자입니다. 표현 형식은 다르지만, 서로 비슷하게 작동됩니다.



### 12.8 ROUND 함수

> 일상생활에서 부가세를 계산하는 경우가 있을 겁니다. 이 경우 부가세를 포함한 금액을 계산하려면 부가세가 5%일 경우 1.05로,  8%일 경우 1.08로 곱셈을 하게됩니다. 경우에 따라서는 부가세를 포함한 금액이 소수점을 가질 수도 있습니다. 이런 경우 거래되는 단위를 고려해 반올림을 하는데, 이때 사용하는 것이 ROUND 함수입니다.
>
> ```MYSQL
> SELECT * FROM sample341;
> ```
>
> ---
>
> 결과
>
> | amount  |
> | ------- |
> | 5961.60 |
> | 2138.40 |
> | 1080.00 |
>
> ---
>
> ```MYSQL
> SELECT amount, ROUND(amount) FROM sample341;
> ```
>
> ---
>
> 결과
>
> | amount  | ROUND(amount) |
> | ------- | ------------- |
> | 5961.60 | 5962          |
> | 2138.40 | 2138          |
> | 1080.00 | 1080          |
>
> ---
>
> 위의 예를 보면 amount 열에는 소수점을 포함하는 수치가 저장되어 있습니다. 다만 INTEGER 형의 경우에는 점수밖에 저장할 수 없기 때문에 DECIMAL 형으로 정의하였습니다. **DECIMAL 형은 열을 정의할 때 정수부와 소수부의 자리수를 지정할 수 있는 자료형**입니다.

- 반올림 자리수 지정

  - ROUND 함수는 기본적으로 소수점 첫째 자리를 기준으로 반올림한 값을 반환합니다.

  - 이때 ROUND 함수의 두 번째 인수로 반올림할 자릿수를 지정할 수 있습니다. 해당 인수를 생략하는 경우는 0으로 간주되어, 소수점 첫째 자리를 반올림합니다. 1을 지정하면 소수점 둘째 자리를 반올림합니다.

    ```MYSQL
    SELECT amount, ROUND(amount, 1) FROM sample341;
    ```

    ---

    결과

    | amount  | ROUND(amount, 1) |
    | ------- | ---------------- |
    | 5961.60 | 5961.6           |
    | 2138.40 | 2138.4           |
    | 1080.00 | 1080.0           |

    ---

  - 음수로 지정해 정수부의 반올림할 자릿수도 지정할 수 있습니다. -1을 지정하면 1단위, -2를 지정하면 10단위를 반올림할 수 있습니다.

  - 그 밖에도 버림을 하는 경우도 있는데, 이는 TRUNCATE 함수로 계산 가능합니다.

- 이외에도 SQRT, SIN, COS, LOG등 수많은 함수가 제공됩니다.

